<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Identify the characteristics of patients in data mapped to the Observational Medical Outcomes Partnership (OMOP) common data model.">
<title>Identify characteristics of patients in the OMOP Common Data Model • PatientProfiles</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Identify characteristics of patients in the OMOP Common Data Model">
<meta property="og:description" content="Identify the characteristics of patients in data mapped to the Observational Medical Outcomes Partnership (OMOP) common data model.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">PatientProfiles</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/addCohortIntersect_vignettes.html">Get cohort intersect using PatientProfiles</a>
    <a class="dropdown-item" href="articles/addPatientCharacteristicsToCohort.html">Get cohort patients characteristics</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="patientprofiles-">PatientProfiles <img src="reference/figures/Hex.png" align="right" height="139"><a class="anchor" aria-label="anchor" href="#patientprofiles-"></a>
</h1></div>
<p><a href="https://CRAN.R-project.org/package=PatientProfiles" class="external-link"><img src="https://www.r-pkg.org/badges/version/PatientProfiles" alt="CRAN status"></a> <a href="https://codecov.io/github/darwin-eu/PatientProfiles?branch=main" class="external-link"><img src="https://codecov.io/github/darwin-eu/PatientProfiles/coverage.svg?branch=main" alt="codecov.io"></a> <a href="https://github.com/darwin-eu/PatientProfiles/actions" class="external-link"><img src="https://github.com/darwin-eu/PatientProfiles/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a> <a href="https://www.tidyverse.org/lifecycle/#experimental" class="external-link"><img src="https://img.shields.io/badge/Lifecycle-Experimental-339999" alt="Lifecycle:Experimental"></a></p>
<div class="section level2">
<h2 id="package-overview">Package overview<a class="anchor" aria-label="anchor" href="#package-overview"></a>
</h2>
<p>PatientProfiles contains functions for adding characteristics to OMOP CDM tables containing patient level data (e.g. condition_occurrence, drug_exposure, and so on) and OMOP CDM cohort tables. The characteristics that can be added include an individual´s sex, age (relative to a date in the table), and days of prior history. Time varying characteristics, such as age, can be estimated relative to any dates in the corresponding table. In additition, PatientProfiles also provides functionality for identifying intersections between a cohort table and OMOP CDM tables containing patient level data or other cohort tables.</p>
</div>
<div class="section level2">
<h2 id="package-installation">Package installation<a class="anchor" aria-label="anchor" href="#package-installation"></a>
</h2>
<p>You can install the latest version of PatientProfiles like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"oxford-pharmacoepi/PatientProfiles"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-usage">Example usage<a class="anchor" aria-label="anchor" href="#example-usage"></a>
</h2>
<div class="section level3">
<h3 id="create-a-reference-to-data-in-the-omop-cdm-format">Create a reference to data in the OMOP CDM format<a class="anchor" aria-label="anchor" href="#create-a-reference-to-data-in-the-omop-cdm-format"></a>
</h3>
<p>The PatientProfiles package is designed to work with data in the OMOP CDM format, so our first step is to create a reference to the data using the CDMConnector package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CDMConnector</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://oxford-pharmacoepi.github.io/PatientProfiles/">PatientProfiles</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>Creating a connection to a Postgres database would for example look like:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RPostgres</span><span class="fu">::</span><span class="fu">Postgres</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      dbname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_DBNAME"</span><span class="op">)</span>,</span>
<span>                      host <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_HOST"</span><span class="op">)</span>,</span>
<span>                      user <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_USER"</span><span class="op">)</span>,</span>
<span>                      password <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_PASSWORD"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu">CDMConnector</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/CDMConnector/man/cdm_from_con.html" class="external-link">cdm_from_con</a></span><span class="op">(</span><span class="va">con</span>, </span>
<span>                    cdm_schema <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_CDM_SCHEMA"</span><span class="op">)</span>, </span>
<span>                    write_schema <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CDM5_POSTGRESQL_RESULT_SCHEMA"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To see how you would create a reference to your database please consult the CDMConnector package documentation. For this example though we´ll work with simulated data, and we’ll generate an example cdm reference like so:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/mockPatientProfiles.html">mockPatientProfiles</a></span><span class="op">(</span>patient_size <span class="op">=</span> <span class="fl">1000</span>, drug_exposure_size <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-individuals-chartacteristics">Adding individuals´ chartacteristics<a class="anchor" aria-label="anchor" href="#adding-individuals-chartacteristics"></a>
</h3>
<div class="section level4">
<h4 id="adding-chartacteristics-to-patient-level-data">Adding chartacteristics to patient-level data<a class="anchor" aria-label="anchor" href="#adding-chartacteristics-to-patient-level-data"></a>
</h4>
<p>Say we wanted to get individuals´sex and age at condition start date for records in the condition_occurrence table. We can use the <code>addAge</code> and <code>addSex</code> functions to do this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; Database: DuckDB 0.5.0 [unknown@Linux 5.4.0-139-generic:R 4.1.2/:memory:]</span></span>
<span><span class="co">#&gt; $ condition_occurrence_id &lt;int&gt; 314, 970, 349, 234, 193, 919, 113, 277, 491, 9…</span></span>
<span><span class="co">#&gt; $ person_id               &lt;int&gt; 314, 970, 349, 234, 193, 919, 113, 277, 491, 9…</span></span>
<span><span class="co">#&gt; $ condition_concept_id    &lt;int&gt; 4, 5, 1, 2, 3, 4, 3, 2, 1, 2, 1, 5, 3, 4, 4, 1…</span></span>
<span><span class="co">#&gt; $ condition_start_date    &lt;date&gt; 2005-08-25, 2007-02-15, 2009-02-15, 2008-05-0…</span></span>
<span><span class="co">#&gt; $ condition_end_date      &lt;date&gt; 2006-06-14, 2007-06-05, 2011-06-24, 2009-01-0…</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span>  <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/addAge.html">addAge</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, indexDate <span class="op">=</span> <span class="st">"condition_start_date"</span><span class="op">)</span>  <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/addSex.html">addSex</a></span><span class="op">(</span><span class="va">cdm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; Database: DuckDB 0.5.0 [unknown@Linux 5.4.0-139-generic:R 4.1.2/:memory:]</span></span>
<span><span class="co">#&gt; $ condition_occurrence_id &lt;int&gt; 314, 970, 349, 234, 193, 919, 113, 277, 491, 9…</span></span>
<span><span class="co">#&gt; $ subject_id              &lt;int&gt; 314, 970, 349, 234, 193, 919, 113, 277, 491, 9…</span></span>
<span><span class="co">#&gt; $ condition_concept_id    &lt;int&gt; 4, 5, 1, 2, 3, 4, 3, 2, 1, 2, 1, 5, 3, 4, 1, 3…</span></span>
<span><span class="co">#&gt; $ condition_start_date    &lt;date&gt; 2005-08-25, 2007-02-15, 2009-02-15, 2008-05-0…</span></span>
<span><span class="co">#&gt; $ condition_end_date      &lt;date&gt; 2006-06-14, 2007-06-05, 2011-06-24, 2009-01-0…</span></span>
<span><span class="co">#&gt; $ age                     &lt;dbl&gt; 58, 77, 68, 58, 63, 54, 52, 23, 85, 74, 10, 77…</span></span>
<span><span class="co">#&gt; $ sex                     &lt;chr&gt; "Male", "Female", "Female", "Male", "Female", …</span></span></code></pre></div>
<p>We could, for example, then limit our data to only males aged between 18 and 65</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span>  <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">65</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Source:   SQL [?? x 7]</span></span>
<span><span class="co">#&gt; # Database: DuckDB 0.5.0 [unknown@Linux 5.4.0-139-generic:R 4.1.2/:memory:]</span></span>
<span><span class="co">#&gt;    condition_occurrence_id subject_id condit…¹ conditio…² conditio…³   age sex  </span></span>
<span><span class="co">#&gt;                      &lt;int&gt;      &lt;int&gt;    &lt;int&gt; &lt;date&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1                     314        314        4 2005-08-25 2006-06-14    58 Male </span></span>
<span><span class="co">#&gt;  2                     234        234        2 2008-05-03 2009-01-05    58 Male </span></span>
<span><span class="co">#&gt;  3                     277        277        2 2007-04-26 2007-05-07    23 Male </span></span>
<span><span class="co">#&gt;  4                     944        944        3 2018-08-11 2019-06-22    50 Male </span></span>
<span><span class="co">#&gt;  5                     110        110        3 2014-10-26 2014-12-26    39 Male </span></span>
<span><span class="co">#&gt;  6                     249        249        2 2014-12-08 2015-03-08    49 Male </span></span>
<span><span class="co">#&gt;  7                     150        150        4 2011-08-31 2012-06-02    55 Male </span></span>
<span><span class="co">#&gt;  8                     406        406        3 2009-02-11 2010-11-25    54 Male </span></span>
<span><span class="co">#&gt;  9                     438        438        1 2008-09-26 2010-08-25    59 Male </span></span>
<span><span class="co">#&gt; 10                     536        536        4 2009-11-11 2010-06-07    21 Male </span></span>
<span><span class="co">#&gt; # … with more rows, and abbreviated variable names ¹​condition_concept_id,</span></span>
<span><span class="co">#&gt; #   ²​condition_start_date, ³​condition_end_date</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adding-chartacteristics-of-a-cohort">Adding chartacteristics of a cohort<a class="anchor" aria-label="anchor" href="#adding-chartacteristics-of-a-cohort"></a>
</h4>
<p>As with other tables in the OMOP CDM, we can work in a similar way with cohort tables. For example, say we have the below cohort table</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB 0.5.0 [unknown@Linux 5.4.0-139-generic:R 4.1.2/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;dbl&gt; 1, 1, 1, 2</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;dbl&gt; 1, 1, 2, 3</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 2020-01-01, 2020-06-01, 2020-01-02, 2020-01-01</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 2020-04-01, 2020-08-01, 2020-02-02, 2020-03-01</span></span></code></pre></div>
<p>We can add age, age groups, sex, and days of prior history to a cohort like so</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/addAge.html">addAge</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>, indexDate <span class="op">=</span> <span class="st">"cohort_start_date"</span>,</span>
<span>         ageGroup <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">18</span><span class="op">)</span>,  </span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">65</span><span class="op">)</span>, </span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">66</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span>          <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/addSex.html">addSex</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/addPriorHistory.html">addPriorHistory</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 8</span></span>
<span><span class="co">#&gt; Database: DuckDB 0.5.0 [unknown@Linux 5.4.0-139-generic:R 4.1.2/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;dbl&gt; 2, 1, 1, 1</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;dbl&gt; 3, 1, 2, 1</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 2020-01-01, 2020-06-01, 2020-01-02, 2020-01-01</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 2020-03-01, 2020-08-01, 2020-02-02, 2020-04-01</span></span>
<span><span class="co">#&gt; $ age                  &lt;dbl&gt; 43, 41, 51, 41</span></span>
<span><span class="co">#&gt; $ age_group            &lt;chr&gt; "19 to 65", "19 to 65", "19 to 65", "19 to 65"</span></span>
<span><span class="co">#&gt; $ sex                  &lt;chr&gt; "Female", "Male", "Male", "Male"</span></span>
<span><span class="co">#&gt; $ prior_history        &lt;dbl&gt; 4635, 5350, 4168, 5198</span></span></code></pre></div>
<p>We could use this information to subset the cohort. For example limiting to those with at least 365 days of prior history available before their cohort start date like so</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span>  <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">prior_history</span> <span class="op">&gt;=</span> <span class="fl">365</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Source:   SQL [4 x 8]</span></span>
<span><span class="co">#&gt; # Database: DuckDB 0.5.0 [unknown@Linux 5.4.0-139-generic:R 4.1.2/:memory:]</span></span>
<span><span class="co">#&gt;   cohort_definition_id subje…¹ cohort_s…² cohort_e…³   age age_g…⁴ sex   prior…⁵</span></span>
<span><span class="co">#&gt;                  &lt;dbl&gt;   &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1                    2       3 2020-01-01 2020-03-01    43 19 to … Fema…    4635</span></span>
<span><span class="co">#&gt; 2                    1       1 2020-06-01 2020-08-01    41 19 to … Male     5350</span></span>
<span><span class="co">#&gt; 3                    1       2 2020-01-02 2020-02-02    51 19 to … Male     4168</span></span>
<span><span class="co">#&gt; 4                    1       1 2020-01-01 2020-04-01    41 19 to … Male     5198</span></span>
<span><span class="co">#&gt; # … with abbreviated variable names ¹​subject_id, ²​cohort_start_date,</span></span>
<span><span class="co">#&gt; #   ³​cohort_end_date, ⁴​age_group, ⁵​prior_history</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="cohort-intersections">Cohort intersections<a class="anchor" aria-label="anchor" href="#cohort-intersections"></a>
</h3>
<div class="section level4">
<h4 id="intersections-with-patient-level-data">Intersections with patient-level data<a class="anchor" aria-label="anchor" href="#intersections-with-patient-level-data"></a>
</h4>
<p>We can use <code>addCohortIntersect</code> to add the intersection between a cohort table and OMOP CDM tables.</p>
<p>For example, if we want to identify anyone with a drug exposure prior to their cohort start date we could do this like so:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB 0.5.0 [unknown@Linux 5.4.0-139-generic:R 4.1.2/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;dbl&gt; 1, 1, 1, 2</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;dbl&gt; 1, 1, 2, 3</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 2020-01-01, 2020-06-01, 2020-01-02, 2020-01-01</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 2020-04-01, 2020-08-01, 2020-02-02, 2020-03-01</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span>  <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">addTableIntersect</span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>                    name <span class="op">=</span> <span class="st">"history_of_drug_exposure"</span>,</span>
<span>                    tableName <span class="op">=</span> <span class="st">"drug_exposure"</span>, </span>
<span>                    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,  </span>
<span>                    value <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 5</span></span>
<span><span class="co">#&gt; Database: DuckDB 0.5.0 [unknown@Linux 5.4.0-139-generic:R 4.1.2/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id           &lt;dbl&gt; 1, 1, 2, 1</span></span>
<span><span class="co">#&gt; $ subject_id                     &lt;dbl&gt; 1, 1, 3, 2</span></span>
<span><span class="co">#&gt; $ cohort_start_date              &lt;date&gt; 2020-01-01, 2020-06-01, 2020-01-01, 202…</span></span>
<span><span class="co">#&gt; $ cohort_end_date                &lt;date&gt; 2020-04-01, 2020-08-01, 2020-03-01, 202…</span></span>
<span><span class="co">#&gt; $ `binary_drug_exposure_(NA,-1)` &lt;dbl&gt; 1, 1, 1, 0</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="intersections-with-another-cohort">Intersections with another cohort<a class="anchor" aria-label="anchor" href="#intersections-with-another-cohort"></a>
</h4>
<p>We can use <code>addCohortIntersect</code> to compare two cohort tables.</p>
<p>Say we have the two following cohort tables</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB 0.5.0 [unknown@Linux 5.4.0-139-generic:R 4.1.2/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;dbl&gt; 1, 1, 1, 2</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;dbl&gt; 1, 1, 2, 3</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 2020-01-01, 2020-06-01, 2020-01-02, 2020-01-01</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 2020-04-01, 2020-08-01, 2020-02-02, 2020-03-01</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort2</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB 0.5.0 [unknown@Linux 5.4.0-139-generic:R 4.1.2/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;dbl&gt; 1, 1, 2, 3, 1</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;dbl&gt; 1, 3, 1, 2, 1</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 2019-12-30, 2020-01-01, 2020-05-25, 2020-01-01, 2…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 2019-12-30, 2020-01-01, 2020-05-25, 2020-01-01, 2…</span></span></code></pre></div>
<p>If we want to add a variable to cohorts in the cohort table 1 identifying whether an individual was in the cohort table cohort2 and cohort definition id 1 any time prior to the cohort start date. we could add this like so:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">addCohortIntersect</span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>,  </span>
<span>                     name <span class="op">=</span> <span class="st">"history_of_cohort_2_id_1"</span>,</span>
<span>                     cohortTableName <span class="op">=</span> <span class="st">"cohort2"</span>, </span>
<span>                     cohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                     window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,  </span>
<span>                     value <span class="op">=</span> <span class="st">"binary"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort2</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: ??</span></span>
<span><span class="co">#&gt; Columns: 4</span></span>
<span><span class="co">#&gt; Database: DuckDB 0.5.0 [unknown@Linux 5.4.0-139-generic:R 4.1.2/:memory:]</span></span>
<span><span class="co">#&gt; $ cohort_definition_id &lt;dbl&gt; 1, 1, 2, 3, 1</span></span>
<span><span class="co">#&gt; $ subject_id           &lt;dbl&gt; 1, 3, 1, 2, 1</span></span>
<span><span class="co">#&gt; $ cohort_start_date    &lt;date&gt; 2019-12-30, 2020-01-01, 2020-05-25, 2020-01-01, 2…</span></span>
<span><span class="co">#&gt; $ cohort_end_date      &lt;date&gt; 2019-12-30, 2020-01-01, 2020-05-25, 2020-01-01, 2…</span></span></code></pre></div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2)</small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing PatientProfiles</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Marti Catala <br><small class="roles"> Author, maintainer </small>  </li>
<li>Yuchen Guo <br><small class="roles"> Author </small>  </li>
<li>Mike Du <br><small class="roles"> Author </small>  </li>
<li>Kim Lopez-Guell <br><small class="roles"> Author </small>  </li>
<li>Edward Burn <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marti Catala, Yuchen Guo, Mike Du, Kim Lopez-Guell, Edward Burn.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
