<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PatientProfiles">
<title>Get patients' characteristics • PatientProfiles</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get patients' characteristics">
<meta property="og:description" content="PatientProfiles">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PatientProfiles</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/addCohortIntersections.html">Get cohort intersections</a>
    <a class="dropdown-item" href="../articles/addPatientCharacteristics.html">Get patients' characteristics</a>
    <a class="dropdown-item" href="../articles/ExampleAnalysis.html">Using PatientProfiles for analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/darwin-eu-dev/PatientProfiles/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Get patients' characteristics</h1>
                        <h4 data-toc-skip class="author">Martí Català,
Mike Du, Yuchen Guo, Kim López-Güell, Xintong Li, Núria Mercadé-Besora,
and Edward Burn</h4>
            
            <h4 data-toc-skip class="date">2024-03-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/darwin-eu-dev/PatientProfiles/blob/HEAD/vignettes/addPatientCharacteristics.rmd" class="external-link"><code>vignettes/addPatientCharacteristics.rmd</code></a></small>
      <div class="d-none name"><code>addPatientCharacteristics.rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we show different functions to get characteristics
(e.g. age, sex, prior history…) of subjects in OMOP CDM tables and
cohort tables. This can be useful when doing explanatory analysis as
well as calling these functions for more complex analyses.</p>
<p>The PatientProfiles package is designed to work with data in the OMOP
CDM format, so our first step is to create a reference to the data using
the DBI and CDMConnector packages. The connection to a Postgres database
would look like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu.github.io/CDMConnector/" class="external-link">CDMConnector</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The input arguments provided are for illustrative purposes only and do not provide access to any database.</span></span>
<span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RPostgres</span><span class="fu">::</span><span class="fu"><a href="https://rpostgres.r-dbi.org/reference/Postgres.html" class="external-link">Postgres</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dbname <span class="op">=</span> <span class="st">"omop_cdm"</span>,</span>
<span>  host <span class="op">=</span> <span class="st">"10.80.192.00"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"user_name"</span>,</span>
<span>  password <span class="op">=</span> <span class="st">"user_pasword"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu">CDMConnector</span><span class="fu">::</span><span class="fu"><a href="https://darwin-eu.github.io/CDMConnector/reference/cdm_from_con.html" class="external-link">cdm_from_con</a></span><span class="op">(</span><span class="va">con</span>,</span>
<span>  cdm_schema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  write_schema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  cohort_tables <span class="op">=</span> <span class="st">"cohort_example"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For this example we will work with simulated data generated by the
<code><a href="../reference/mockPatientProfiles.html">mockPatientProfiles()</a></code> function provided in this package,
which mimics a database formatted in OMOP:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu-dev.github.io/PatientProfiles/">PatientProfiles</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mockPatientProfiles.html">mockPatientProfiles</a></span><span class="op">(</span></span>
<span>  patient_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  drug_exposure_size <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-get-characteristics-in-tables">Example: get characteristics in tables<a class="anchor" aria-label="anchor" href="#example-get-characteristics-in-tables"></a>
</h2>
<p><code><a href="../reference/addAge.html">addAge()</a></code>: adds a new column to the input table
containing each patient’s age at a certain date, specified in indexDate.
Function allows to set month and/or day of birth to patients with
missings or it can be imposed to all subjects. Further, the function can
classify patient’s into different age groups based on the argument
ageGroup.</p>
<p>Suppose we want to calculate the age at condition start date for
records in the condition_occurrence table. Also, we wan to group
patients in 20-year age band and if they are 60 years old or more.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 6</span></span>
<span><span class="co">## Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.3/:memory:]</span></span>
<span><span class="co">## $ condition_occurrence_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…</span></span>
<span><span class="co">## $ person_id                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…</span></span>
<span><span class="co">## $ condition_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 4, 3, 5, 2, 3, 4, 4, 3, 5, 4, 1, 1, 4, 4, 3,…</span></span>
<span><span class="co">## $ condition_start_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2005-06-30, 2005-05-28, 2008-06-30, 2011-01…</span></span>
<span><span class="co">## $ condition_end_date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2007-07-25, 2007-09-16, 2010-10-06, 2011-10…</span></span>
<span><span class="co">## $ condition_type_concept_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence_mod</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addAge.html">addAge</a></span><span class="op">(</span></span>
<span>    ageDefaultMonth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ageDefaultDay <span class="op">=</span> <span class="fl">6</span>,</span>
<span>    indexDate <span class="op">=</span> <span class="st">"condition_start_date"</span>,</span>
<span>    ageGroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"age_band_20"</span> <span class="op">=</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"0 to 19"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">19</span><span class="op">)</span>,</span>
<span>          <span class="st">"20 to 39"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">39</span><span class="op">)</span>,</span>
<span>          <span class="st">"40 to 59"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">59</span><span class="op">)</span>,</span>
<span>          <span class="st">"60 to 79"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">79</span><span class="op">)</span>,</span>
<span>          <span class="st">"80 to 99"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">99</span><span class="op">)</span>,</span>
<span>          <span class="st">"&gt;= 100"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">150</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>      <span class="st">"age_threshold_60"</span> <span class="op">=</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>          <span class="st">"less60"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">59</span><span class="op">)</span>,</span>
<span>          <span class="st">"more60"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">150</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"condition_occurrence_mod"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence_mod</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 9</span></span>
<span><span class="co">## Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.3/:memory:]</span></span>
<span><span class="co">## $ condition_occurrence_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…</span></span>
<span><span class="co">## $ person_id                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…</span></span>
<span><span class="co">## $ condition_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 4, 3, 5, 2, 3, 4, 4, 3, 5, 4, 1, 1, 4, 4, 1,…</span></span>
<span><span class="co">## $ condition_start_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2005-06-30, 2005-05-28, 2008-06-30, 2011-01…</span></span>
<span><span class="co">## $ condition_end_date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2007-07-25, 2007-09-16, 2010-10-06, 2011-10…</span></span>
<span><span class="co">## $ condition_type_concept_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ age                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 7, 59, 9, 62, 69, 38, 23, 83, 43, 28, 47, 54…</span></span>
<span><span class="co">## $ age_band_20               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0 to 19", "40 to 59", "0 to 19", "60 to 79"…</span></span>
<span><span class="co">## $ age_threshold_60          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "less60", "less60", "less60", "more60", "mor…</span></span></code></pre>
<p><code><a href="../reference/addSex.html">addSex()</a></code>: appends a column to the input table indicating
the sex for each patient as “Female” or “Male”.</p>
<p>First, we can add the sex of the patients to the table. This
information can be used to count the occurrences of the
condition_concept_id = 5 in males aged 60 years or older. We can also
stratify the number of events by age, grouping patients into 20-year age
bands.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence_mod</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence_mod</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addSex.html">addSex</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence_mod</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 10</span></span>
<span><span class="co">## Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.3/:memory:]</span></span>
<span><span class="co">## $ condition_occurrence_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…</span></span>
<span><span class="co">## $ person_id                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…</span></span>
<span><span class="co">## $ condition_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 4, 3, 5, 2, 3, 4, 4, 3, 5, 4, 1, 1, 4, 4, 1,…</span></span>
<span><span class="co">## $ condition_start_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2005-06-30, 2005-05-28, 2008-06-30, 2011-01…</span></span>
<span><span class="co">## $ condition_end_date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2007-07-25, 2007-09-16, 2010-10-06, 2011-10…</span></span>
<span><span class="co">## $ condition_type_concept_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ age                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 7, 59, 9, 62, 69, 38, 23, 83, 43, 28, 47, 54…</span></span>
<span><span class="co">## $ age_band_20               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0 to 19", "40 to 59", "0 to 19", "60 to 79"…</span></span>
<span><span class="co">## $ age_threshold_60          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "less60", "less60", "less60", "more60", "mor…</span></span>
<span><span class="co">## $ sex                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Female", "Female", "Male", "Female", "Male"…</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">numConditions</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence_mod</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">sex</span> <span class="op">==</span> <span class="st">"Male"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">age_threshold_60</span> <span class="op">==</span> <span class="st">"more60"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">condition_concept_id</span> <span class="op">==</span> <span class="fl">5</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span></span>
<span>    <span class="va">age_band_20</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">condition_occurrence_id</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">numConditions</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># Source:   SQL [2 x 2]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.3/:memory:]</span></span></span>
<span><span class="co">##   age_band_20     n</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 80 to 99       15</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 60 to 79       28</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="example-get-characteristics-in-cohort-tables">Example: get characteristics in cohort tables<a class="anchor" aria-label="anchor" href="#example-get-characteristics-in-cohort-tables"></a>
</h2>
<p>PatientProfiles functions can be used on both OMOP CDM tables and
cohort tables. In this example we will see some of the package
functionalities applied to a cohort table:</p>
<p><code><a href="../reference/addInObservation.html">addInObservation()</a></code>: adds a new binary column to the
input table, indicating whether the subjects are being observed at a
specific time.</p>
<p><code><a href="../reference/addPriorObservation.html">addPriorObservation()</a></code>: appends a column to the input
table containing the number of days each patient has been in observation
up to a specified date.</p>
<p><code><a href="../reference/addFutureObservation.html">addFutureObservation()</a></code>: adds a column with the days of
future observation for an individual at a certain date</p>
<p>We can use the first function to obtain patients which are in
observation at “cohort_start_date” and subsequently get their prior and
future observation days. Notice that we are not using the argument
“indexDate”, since it is already defaulted to “cohort_start_date”.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 4</span></span>
<span><span class="co">## Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.3/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 1, 2</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 2, 3</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-01-01, 2020-06-01, 2020-01-02, 2020-01-01</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-04-01, 2020-08-01, 2020-02-02, 2020-03-01</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addInObservation.html">addInObservation</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">in_observation</span> <span class="op">==</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addPriorObservation.html">addPriorObservation</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addFutureObservation.html">addFutureObservation</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.3/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 2, 1</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 2, 3, 1</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-06-01, 2020-01-02, 2020-01-01, 2020-01-01</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-08-01, 2020-02-02, 2020-03-01, 2020-04-01</span></span>
<span><span class="co">## $ in_observation       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 1, 1</span></span>
<span><span class="co">## $ prior_observation    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 4209, 4486, 5267, 4057</span></span>
<span><span class="co">## $ future_observation   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 9196, 6296, 1121, 9348</span></span></code></pre>
<p>If the database allows for multiple observation periods, it’s
important to note that the results of the previous functions will be
based on the period where “indexDate” falls within. If a patient is not
under observation at the specified date,
<code><a href="../reference/addPriorObservation.html">addPriorObservation()</a></code> and
<code><a href="../reference/addFutureObservation.html">addFutureObservation()</a></code> functions will return NA.</p>
</div>
<div class="section level2">
<h2 id="example-get-all-characteristics-at-once">Example: get all characteristics at once<a class="anchor" aria-label="anchor" href="#example-get-all-characteristics-at-once"></a>
</h2>
<p><code><a href="../reference/addDemographics.html">addDemographics()</a></code>: can be used to add all the features
presented in this vignette (except for <code><a href="../reference/addInObservation.html">addInObservation()</a></code>)
at once, in both tables and cohort tables.</p>
<p>If we want to get the age, sex and prior history of individuals at
the day they enter a cohort, we can use the function
<code><a href="../reference/addDemographics.html">addDemographics()</a></code> as follows</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 4</span></span>
<span><span class="co">## Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.3/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 2, 3, 1</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 3, 1, 2, 1</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2019-12-30, 2020-01-01, 2020-05-25, 2020-01-01, 2…</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2019-12-30, 2020-01-01, 2020-05-25, 2020-01-01, 2…</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort2</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addDemographics.html">addDemographics</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    ageName <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>    ageGroup <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    sex <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sexName <span class="op">=</span> <span class="st">"sex"</span>,</span>
<span>    priorObservation <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    priorObservationName <span class="op">=</span> <span class="st">"prior_observation"</span>,</span>
<span>    futureObservation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## Database: DuckDB v0.9.2 [unknown@Linux 6.5.0-1015-azure:R 4.3.3/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 3, 1, 2, 1</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 2, 3, 1, 1</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-05-25, 2020-01-01, 2020-01-01, 2020-05-25, 2…</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-05-25, 2020-01-01, 2020-01-01, 2020-05-25, 2…</span></span>
<span><span class="co">## $ age                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 22, 73, 21, 22, 22</span></span>
<span><span class="co">## $ sex                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Female", "Female", "Male", "Female", "Female"</span></span>
<span><span class="co">## $ prior_observation    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 4202, 4485, 5267, 4202, 4055</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marti Catala, Yuchen Guo, Mike Du, Kim Lopez-Guell, Edward Burn.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
