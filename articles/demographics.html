<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Adding patient demographics • PatientProfiles</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adding patient demographics">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PatientProfiles</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0.900</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>PatientProfiles</h6></li>
    <li><a class="dropdown-item" href="../articles/demographics.html">Adding patient demographics</a></li>
    <li><a class="dropdown-item" href="../articles/cohort-intersect.html">Adding cohort intersections</a></li>
    <li><a class="dropdown-item" href="../articles/concept-intersect.html">Adding concept intersections</a></li>
    <li><a class="dropdown-item" href="../articles/table-intersect.html">Adding table intersections</a></li>
    <li><a class="dropdown-item" href="../articles/summarise.html">Summarise result</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/darwin-eu-dev/PatientProfiles/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Adding patient demographics</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/darwin-eu-dev/PatientProfiles/blob/main/vignettes/demographics.rmd" class="external-link"><code>vignettes/demographics.rmd</code></a></small>
      <div class="d-none name"><code>demographics.rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The OMOP CDM is a person-centric model. The person table contains
records that uniquely identify each individual along with some of their
demographic information. Below we create a mock CDM reference which, as
is standard, has a person table which contains fields which indicate an
individual’s date of birth, gender, race, and ethnicity. Each of these,
except for date of birth, are represented by a concept ID (and as the
person table contains one record per person these fields are treated as
time-invariant).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu-dev.github.io/PatientProfiles/">PatientProfiles</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mockPatientProfiles.html">mockPatientProfiles</a></span><span class="op">(</span>numberIndividuals <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">person</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 5</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ person_id            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15…</span></span>
<span><span class="co">## $ gender_concept_id    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 8532, 8532, 8507, 8532, 8532, 8507, 8532, 8532, 8…</span></span>
<span><span class="co">## $ year_of_birth        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1940, 1952, 1958, 1906, 1950, 1917, 1967, 1972, 1…</span></span>
<span><span class="co">## $ race_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span></span>
<span><span class="co">## $ ethnicity_concept_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span></span></code></pre>
<p>As well as the person table, every CDM reference will include an
observation period table. This table contains spans of times during
which an individual is considered to being under observation.
Individuals can have multiple observation periods, but they cannot
overlap.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 5</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ person_id                     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1…</span></span>
<span><span class="co">## $ observation_period_start_date <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1940-01-01, 1952-01-01, 1958-01-01, 190…</span></span>
<span><span class="co">## $ observation_period_end_date   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1969-04-09, 1977-04-26, 2000-12-04, 193…</span></span>
<span><span class="co">## $ period_type_concept_id        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span></span>
<span><span class="co">## $ observation_period_id         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1…</span></span></code></pre>
<p>When performing analyses we will often be interested in working with
the person and observation period tables to identify individuals’
characteristics on some date of interest. PatientProfiles provides a
number of functions that can help us do this.</p>
</div>
<div class="section level2">
<h2 id="adding-characteristics-to-omop-cdm-tables">Adding characteristics to OMOP CDM tables<a class="anchor" aria-label="anchor" href="#adding-characteristics-to-omop-cdm-tables"></a>
</h2>
<p>Let’s say we’re working with the condition occurrence table.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 6</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ person_id                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2284, 3335, 9438, 6762, 9433, 9393, 6360, 36…</span></span>
<span><span class="co">## $ condition_start_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1918-10-05, 1934-12-06, 1945-12-27, 1944-09…</span></span>
<span><span class="co">## $ condition_end_date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1925-01-30, 1954-09-30, 1947-08-23, 1947-08…</span></span>
<span><span class="co">## $ condition_occurrence_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…</span></span>
<span><span class="co">## $ condition_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 2, 7, 6, 9, 8, 3, 10, 5, 3, 2, 5, 5, 3…</span></span>
<span><span class="co">## $ condition_type_concept_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span></code></pre>
<p>This table contains diagnoses of individuals and we might, for
example, want to identify their age on their date of diagnosis. This
involves linking back to the person table which contains their date of
birth (split across three different columns). PatientProfiles provides a
simple function for this. <code><a href="../reference/addAge.html">addAge()</a></code> will add a new column to
the table containing each patient’s age relative to the specified index
date.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addAge.html">addAge</a></span><span class="op">(</span>indexDate <span class="op">=</span> <span class="st">"condition_start_date"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ person_id                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2284, 3335, 9438, 6762, 9433, 9393, 6360, 36…</span></span>
<span><span class="co">## $ condition_start_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1918-10-05, 1934-12-06, 1945-12-27, 1944-09…</span></span>
<span><span class="co">## $ condition_end_date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1925-01-30, 1954-09-30, 1947-08-23, 1947-08…</span></span>
<span><span class="co">## $ condition_occurrence_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…</span></span>
<span><span class="co">## $ condition_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 2, 7, 6, 9, 8, 3, 10, 5, 3, 2, 5, 5, 3…</span></span>
<span><span class="co">## $ condition_type_concept_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ age                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 10, 8, 0, 10, 22, 20, 23, 8, 23, 42, 34, 7, …</span></span></code></pre>
<p>As well as calculating age, we can also create age groups at the same
time. Here we create three age groups: those aged 0 to 17, those 18 to
65, and those 66 or older.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addAge.html">addAge</a></span><span class="op">(</span></span>
<span>    indexDate <span class="op">=</span> <span class="st">"condition_start_date"</span>,</span>
<span>    ageGroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"0 to 17"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">17</span><span class="op">)</span>,</span>
<span>      <span class="st">"18 to 65"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">65</span><span class="op">)</span>,</span>
<span>      <span class="st">"&gt;= 66"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">66</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 8</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ person_id                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 74, 266, 318, 410, 427, 434, 450, 457, 468, …</span></span>
<span><span class="co">## $ condition_start_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1969-08-01, 1936-01-11, 1952-08-18, 1957-01…</span></span>
<span><span class="co">## $ condition_end_date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1978-06-27, 1959-01-10, 1967-10-03, 1957-09…</span></span>
<span><span class="co">## $ condition_occurrence_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 21, 81, 88, 105, 109, 117, 32, 41, 36, 82, 7…</span></span>
<span><span class="co">## $ condition_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2, 1, 1, 8, 10, 3, 3, 9, 1, 1, 5, 2, 6, 3, 7…</span></span>
<span><span class="co">## $ condition_type_concept_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ age                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 9, 21, 23, 29, 26, 7, 15, 8, 6, 14, 26, 2…</span></span>
<span><span class="co">## $ age_group                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0 to 17", "0 to 17", "18 to 65", "18 to 65"…</span></span></code></pre>
<p>By default, when adding age the new column will have been called
“age” and will have been calculated using all available information on
date of birth contained in the person. We can though also alter these
defaults. Here, for example, we impose that month of birth is January
and day of birth is the 1st for all individuals.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addAge.html">addAge</a></span><span class="op">(</span></span>
<span>    indexDate <span class="op">=</span> <span class="st">"condition_start_date"</span>,</span>
<span>    ageName <span class="op">=</span> <span class="st">"age_from_year_of_birth"</span>,</span>
<span>    ageMissingMonth <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ageMissingDay <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ageImposeMonth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    ageImposeDay <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 9</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ person_id                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 74, 266, 318, 410, 427, 434, 450, 457, 468, …</span></span>
<span><span class="co">## $ condition_start_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1969-08-01, 1936-01-11, 1952-08-18, 1957-01…</span></span>
<span><span class="co">## $ condition_end_date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1978-06-27, 1959-01-10, 1967-10-03, 1957-09…</span></span>
<span><span class="co">## $ condition_occurrence_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 21, 81, 88, 105, 109, 117, 32, 41, 36, 82, 7…</span></span>
<span><span class="co">## $ condition_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2, 1, 1, 8, 10, 3, 3, 9, 1, 1, 5, 2, 6, 3, 7…</span></span>
<span><span class="co">## $ condition_type_concept_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ age                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 9, 21, 23, 29, 26, 7, 15, 8, 6, 14, 26, 2…</span></span>
<span><span class="co">## $ age_group                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0 to 17", "0 to 17", "18 to 65", "18 to 65"…</span></span>
<span><span class="co">## $ age_from_year_of_birth    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 9, 21, 23, 29, 26, 7, 15, 8, 6, 14, 26, 2…</span></span></code></pre>
<p>As well as age at diagnosis, we might also want identify patients’
sex. PatientProfiles provides the <code><a href="../reference/addSex.html">addSex()</a></code> function that
will add this for us. Because this is treated as time-invariant, we will
not have to specify any index variable.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addSex.html">addSex</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 10</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ person_id                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 74, 266, 318, 410, 427, 434, 450, 457, 468, …</span></span>
<span><span class="co">## $ condition_start_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1969-08-01, 1936-01-11, 1952-08-18, 1957-01…</span></span>
<span><span class="co">## $ condition_end_date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1978-06-27, 1959-01-10, 1967-10-03, 1957-09…</span></span>
<span><span class="co">## $ condition_occurrence_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 21, 81, 88, 105, 109, 117, 32, 41, 36, 82, 1…</span></span>
<span><span class="co">## $ condition_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2, 1, 1, 8, 10, 3, 3, 9, 1, 1, 2, 6, 3, 5, 9…</span></span>
<span><span class="co">## $ condition_type_concept_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ age                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 9, 21, 23, 29, 26, 7, 15, 8, 6, 26, 20, 0…</span></span>
<span><span class="co">## $ age_group                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0 to 17", "0 to 17", "18 to 65", "18 to 65"…</span></span>
<span><span class="co">## $ age_from_year_of_birth    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 9, 21, 23, 29, 26, 7, 15, 8, 6, 26, 20, 0…</span></span>
<span><span class="co">## $ sex                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Female", "Male", "Female", "Female", "Male"…</span></span></code></pre>
<p>Similarly, we could also identify whether an individual was in
observation at the time of their diagnosis (i.e. had an observation
period that overlaps with their diagnosis date), as well as identifying
how much prior observation time they had on this date and how much they
have following it.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addInObservation.html">addInObservation</a></span><span class="op">(</span>indexDate <span class="op">=</span> <span class="st">"condition_start_date"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addPriorObservation.html">addPriorObservation</a></span><span class="op">(</span>indexDate <span class="op">=</span> <span class="st">"condition_start_date"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addFutureObservation.html">addFutureObservation</a></span><span class="op">(</span>indexDate <span class="op">=</span> <span class="st">"condition_start_date"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 13</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ person_id                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 74, 266, 318, 410, 427, 434, 450, 457, 468, …</span></span>
<span><span class="co">## $ condition_start_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1969-08-01, 1936-01-11, 1952-08-18, 1957-01…</span></span>
<span><span class="co">## $ condition_end_date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1978-06-27, 1959-01-10, 1967-10-03, 1957-09…</span></span>
<span><span class="co">## $ condition_occurrence_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 21, 81, 88, 105, 109, 117, 32, 41, 36, 82, 1…</span></span>
<span><span class="co">## $ condition_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2, 1, 1, 8, 10, 3, 3, 9, 1, 1, 2, 6, 3, 5, 9…</span></span>
<span><span class="co">## $ condition_type_concept_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ age                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 9, 21, 23, 29, 26, 7, 15, 8, 6, 26, 20, 0…</span></span>
<span><span class="co">## $ age_group                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0 to 17", "0 to 17", "18 to 65", "18 to 65"…</span></span>
<span><span class="co">## $ age_from_year_of_birth    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 9, 21, 23, 29, 26, 7, 15, 8, 6, 26, 20, 0…</span></span>
<span><span class="co">## $ sex                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Female", "Male", "Female", "Female", "Male"…</span></span>
<span><span class="co">## $ in_observation            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span>
<span><span class="co">## $ prior_observation         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 578, 3297, 7900, 8409, 10879, 9565, 2697, 57…</span></span>
<span><span class="co">## $ future_observation        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 14672, 10185, 12460, 1601, 2901, 4798, 9016,…</span></span></code></pre>
<p>For these functions which work with information from the observation
table, it is important to note that the results will be based on the
observation period during which the index date falls within. Moreover,
if a patient is not under observation at the specified date,
<code><a href="../reference/addPriorObservation.html">addPriorObservation()</a></code> and
<code><a href="../reference/addFutureObservation.html">addFutureObservation()</a></code> functions will return NA.</p>
<p>When checking whether someone is in observation the default is that
we are checking whether someone was in observation on the index date. We
could though expand this and consider a window of time around this date.
For example here we add a variable indicating whether someone was in
observation from 180 days before the index date to 30 days following
it.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addInObservation.html">addInObservation</a></span><span class="op">(</span></span>
<span>    indexDate <span class="op">=</span> <span class="st">"condition_start_date"</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="fl">30</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 13</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ person_id                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 74, 266, 318, 410, 427, 434, 450, 457, 468, …</span></span>
<span><span class="co">## $ condition_start_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1969-08-01, 1936-01-11, 1952-08-18, 1957-01…</span></span>
<span><span class="co">## $ condition_end_date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1978-06-27, 1959-01-10, 1967-10-03, 1957-09…</span></span>
<span><span class="co">## $ condition_occurrence_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 21, 81, 88, 105, 109, 117, 32, 41, 36, 82, 1…</span></span>
<span><span class="co">## $ condition_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2, 1, 1, 8, 10, 3, 3, 9, 1, 1, 2, 6, 3, 5, 9…</span></span>
<span><span class="co">## $ condition_type_concept_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ age                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 9, 21, 23, 29, 26, 7, 15, 8, 6, 26, 20, 0…</span></span>
<span><span class="co">## $ age_group                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0 to 17", "0 to 17", "18 to 65", "18 to 65"…</span></span>
<span><span class="co">## $ age_from_year_of_birth    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 9, 21, 23, 29, 26, 7, 15, 8, 6, 26, 20, 0…</span></span>
<span><span class="co">## $ sex                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Female", "Male", "Female", "Female", "Male"…</span></span>
<span><span class="co">## $ prior_observation         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 578, 3297, 7900, 8409, 10879, 9565, 2697, 57…</span></span>
<span><span class="co">## $ future_observation        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 14672, 10185, 12460, 1601, 2901, 4798, 9016,…</span></span>
<span><span class="co">## $ in_observation            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span></code></pre>
<p>We can also specify a window and require that an individual is
present for only some days within it. Here we add a variable indicating
whether the individual was in observation at least a year in the
future,</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">condition_occurrence</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addInObservation.html">addInObservation</a></span><span class="op">(</span></span>
<span>    indexDate <span class="op">=</span> <span class="st">"condition_start_date"</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">365</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>    completeInterval <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 13</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ person_id                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 74, 266, 318, 410, 427, 434, 450, 457, 468, …</span></span>
<span><span class="co">## $ condition_start_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1969-08-01, 1936-01-11, 1952-08-18, 1957-01…</span></span>
<span><span class="co">## $ condition_end_date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1978-06-27, 1959-01-10, 1967-10-03, 1957-09…</span></span>
<span><span class="co">## $ condition_occurrence_id   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 21, 81, 88, 105, 109, 117, 32, 41, 36, 82, 1…</span></span>
<span><span class="co">## $ condition_concept_id      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2, 1, 1, 8, 10, 3, 3, 9, 1, 1, 2, 6, 3, 5, 9…</span></span>
<span><span class="co">## $ condition_type_concept_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…</span></span>
<span><span class="co">## $ age                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 9, 21, 23, 29, 26, 7, 15, 8, 6, 26, 20, 0…</span></span>
<span><span class="co">## $ age_group                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0 to 17", "0 to 17", "18 to 65", "18 to 65"…</span></span>
<span><span class="co">## $ age_from_year_of_birth    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 9, 21, 23, 29, 26, 7, 15, 8, 6, 26, 20, 0…</span></span>
<span><span class="co">## $ sex                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Female", "Male", "Female", "Female", "Male"…</span></span>
<span><span class="co">## $ prior_observation         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 578, 3297, 7900, 8409, 10879, 9565, 2697, 57…</span></span>
<span><span class="co">## $ future_observation        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 14672, 10185, 12460, 1601, 2901, 4798, 9016,…</span></span>
<span><span class="co">## $ in_observation            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="adding-characteristics-to-a-cohort-tables">Adding characteristics to a cohort tables<a class="anchor" aria-label="anchor" href="#adding-characteristics-to-a-cohort-tables"></a>
</h2>
<p>The above functions can be used on both standard OMOP CDM tables and
cohort tables. Note as the default index date in the functions is
“cohort_start_date” we can now omit this.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 4</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 2, 1, 3, 2, 2, 2, 1, 3, 3, 1, 3, 2, 3…</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 5853, 1622, 8574, 6414, 7299, 4793, 6541, 1029, 5…</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1964-06-05, 1927-03-08, 1955-08-04, 1963-06-12, …</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1964-12-11, 1934-04-21, 1958-05-01, 1983-11-26, …</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addAge.html">addAge</a></span><span class="op">(</span>ageGroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"0 to 17"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">17</span><span class="op">)</span>,</span>
<span>    <span class="st">"18 to 65"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">65</span><span class="op">)</span>,</span>
<span>    <span class="st">"&gt;= 66"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">66</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addSex.html">addSex</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addInObservation.html">addInObservation</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addPriorObservation.html">addPriorObservation</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addFutureObservation.html">addFutureObservation</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 10</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 3, 2, 1, 2, 1, 3, 2, 2, 1, 2, 3, 3, 3, 2, 1, 3, 3…</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16, 17,…</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1957-08-12, 1957-03-05, 1985-01-22, 1923-05-21, …</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1966-11-16, 1960-04-16, 1999-11-20, 1948-03-23, …</span></span>
<span><span class="co">## $ age                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 17, 5, 27, 6, 22, 10, 2, 11, 4, 21, 10, 2, 11, 12…</span></span>
<span><span class="co">## $ age_group            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0 to 17", "0 to 17", "18 to 65", "0 to 17", "18 …</span></span>
<span><span class="co">## $ sex                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Female", "Female", "Male", "Male", "Female", "Fe…</span></span>
<span><span class="co">## $ in_observation       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></span>
<span><span class="co">## $ prior_observation    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 6433, 1890, 9883, 2331, 8400, 3929, 1061, 4123, 1…</span></span>
<span><span class="co">## $ future_observation   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 4258, 7357, 5795, 9935, 672, 6928, 4450, 13069, 8…</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="getting-multiple-characteristics-at-once">Getting multiple characteristics at once<a class="anchor" aria-label="anchor" href="#getting-multiple-characteristics-at-once"></a>
</h2>
<p>The above functions, which are chained together, each fetch the
related information one by one. In the cases where we are interested in
adding multiple characteristics, we can add these all at the same time
using the more general <code><a href="../reference/addDemographics.html">addDemographics()</a></code> functions. This
will be more efficient that adding characteristics as it requires fewer
joins between our table of interest and the person and observation
period tables.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 4</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 3, 3, 1, 3, 1, 1, 2, 3, 3, 1, 2, 1, 2, 2, 1, 1, 3…</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 6688, 3035, 5292, 1351, 8144, 699, 8733, 1007, 68…</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1999-06-28, 1977-03-24, 1931-10-19, 1993-07-08, …</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2019-08-31, 1988-06-17, 1937-06-27, 2003-11-19, …</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addAge.html">addAge</a></span><span class="op">(</span>ageGroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"0 to 17"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">17</span><span class="op">)</span>,</span>
<span>    <span class="st">"18 to 65"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">65</span><span class="op">)</span>,</span>
<span>    <span class="st">"&gt;= 66"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">66</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addSex.html">addSex</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addInObservation.html">addInObservation</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addPriorObservation.html">addPriorObservation</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addFutureObservation.html">addFutureObservation</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># Source:   table&lt;og_024_1729815404&gt; [?? x 10]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span></span>
<span><span class="co">##    cohort_definition_id subject_id cohort_start_date cohort_end_date   age</span></span>
<span><span class="co">##                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>                    2          1 1940-11-29        1959-10-09          0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>                    3          2 1963-05-30        1977-03-31         11</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>                    2          3 1993-09-04        1995-07-27         35</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>                    3          4 1923-10-12        1926-04-27         17</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>                    3          5 1954-06-30        1955-12-24          4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>                    2          6 1923-07-07        1940-06-01          6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>                    3          7 1989-02-22        1991-02-24         22</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>                    2          8 1992-10-16        2017-04-23         20</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>                    3          9 1985-09-19        1997-05-06         12</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>                    3         10 1935-05-26        1936-02-06         12</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5 more variables: age_group &lt;chr&gt;, sex &lt;chr&gt;, in_observation &lt;int&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   prior_observation &lt;int&gt;, future_observation &lt;int&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 1.187 sec elapsed</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addDemographics.html">addDemographics</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    ageName <span class="op">=</span> <span class="st">"age"</span>,</span>
<span>    ageGroup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="st">"0 to 17"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">17</span><span class="op">)</span>,</span>
<span>      <span class="st">"18 to 65"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">65</span><span class="op">)</span>,</span>
<span>      <span class="st">"&gt;= 66"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">66</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    sex <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sexName <span class="op">=</span> <span class="st">"sex"</span>,</span>
<span>    priorObservation <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    priorObservationName <span class="op">=</span> <span class="st">"prior_observation"</span>,</span>
<span>    futureObservation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 8</span></span>
<span><span class="co">## Database: DuckDB v1.1.1 [unknown@Linux 6.5.0-1025-azure:R 4.4.1/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 2, 3, 2, 3, 3, 2, 3, 2, 3, 3, 2, 1, 3, 2, 3, 2, 3…</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 15, 16…</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1940-11-29, 1963-05-30, 1993-09-04, 1923-10-12, …</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1959-10-09, 1977-03-31, 1995-07-27, 1926-04-27, …</span></span>
<span><span class="co">## $ age                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 11, 35, 17, 4, 6, 22, 20, 12, 12, 14, 25, 2, 4…</span></span>
<span><span class="co">## $ age_group            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "0 to 17", "0 to 17", "18 to 65", "0 to 17", "0 t…</span></span>
<span><span class="co">## $ sex                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Female", "Female", "Male", "Female", "Female", "…</span></span>
<span><span class="co">## $ prior_observation    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 333, 4167, 13030, 6493, 1641, 2378, 8088, 7594, 4…</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tictoc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0.461 sec elapsed</span></span></code></pre>
<p>In our small mock dataset we see a small improvement in performance,
but this difference will become much more noticeable when working with
real data that will typically be far larger.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marti Catala, Yuchen Guo, Mike Du, Kim Lopez-Guell, Edward Burn, Nuria Mercade-Besora.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
