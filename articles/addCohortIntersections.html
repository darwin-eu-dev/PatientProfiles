<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PatientProfiles">
<title>Get cohort intersections • PatientProfiles</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get cohort intersections">
<meta property="og:description" content="PatientProfiles">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PatientProfiles</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/addCohortIntersections.html">Get cohort intersections</a>
    <a class="dropdown-item" href="../articles/addPatientCharacteristics.html">Get patients' characteristics</a>
    <a class="dropdown-item" href="../articles/ExampleAnalysis.html">Using PatientProfiles for analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Get cohort intersections</h1>
                        <h4 data-toc-skip class="author">Martí Català,
Mike Du, Yuchen Guo, Kim Lopez-Guell, Xintong Li, Núria Mercadé-Besora,
and Edward Burn</h4>
            
            <h4 data-toc-skip class="date">2023-04-25</h4>
      
      
      <div class="d-none name"><code>addCohortIntersections.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we present how function from this package can be
used to get intersecctions between cohorts. This can be useful, for
instance, if we want to identify patients with previous conditions.</p>
<p>The PatientProfiles package is designed to work with data in the OMOP
CDM format, so our first step is to create a reference to the data using
the DBI and CDMConnector packages. The connection to a Postgres database
would look like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CDMConnector</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The input arguments provided are for illustrative purposes only and do not provide access to any database.</span></span>
<span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RPostgres</span><span class="fu">::</span><span class="fu">Postgres</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      dbname <span class="op">=</span> <span class="st">"omop_cdm"</span>,          </span>
<span>                      host <span class="op">=</span> <span class="st">"10.80.192.00"</span>,</span>
<span>                      user <span class="op">=</span> <span class="st">"user_name"</span>,</span>
<span>                      password <span class="op">=</span> <span class="st">"user_pasword"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu">CDMConnector</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/CDMConnector/man/cdm_from_con.html" class="external-link">cdm_from_con</a></span><span class="op">(</span><span class="va">con</span>,</span>
<span>                                  cdm_schema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>                                  write_schema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>                                  cohort_tables <span class="op">=</span> <span class="st">"cohort_example"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this vignette we will work with simulated data generated by the
<code><a href="../reference/mockPatientProfiles.html">mockPatientProfiles()</a></code> function provided in this package,
which mimics a database formatted in OMOP.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://oxford-pharmacoepi.github.io/PatientProfiles/">PatientProfiles</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mockPatientProfiles.html">mockPatientProfiles</a></span><span class="op">(</span></span>
<span>  patient_size <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>  drug_exposure_size <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this mock dataset there are the following cohort tables:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 4</span></span>
<span><span class="co">## Database: DuckDB 0.7.1 [unknown@Linux 5.15.0-1035-azure:R 4.3.0/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 1, 2</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 2, 3</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-01-01, 2020-06-01, 2020-01-02, 2020-01-01</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-04-01, 2020-08-01, 2020-02-02, 2020-03-01</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span>                       </span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 4</span></span>
<span><span class="co">## Database: DuckDB 0.7.1 [unknown@Linux 5.15.0-1035-azure:R 4.3.0/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 2, 3, 1</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 3, 1, 2, 1</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2019-12-30, 2020-01-01, 2020-05-25, 2020-01-01, 2…</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2019-12-30, 2020-01-01, 2020-05-25, 2020-01-01, 2…</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="example-flagcohortpresence-and-countcohortoccurrences-functions">Example: flagCohortPresence and countCohortOccurrences
functions<a class="anchor" aria-label="anchor" href="#example-flagcohortpresence-and-countcohortoccurrences-functions"></a>
</h2>
<p><code><a href="../reference/flagCohortPresence.html">flagCohortPresence()</a></code>: adds a binary column indicate
intersection with a cohort in a time frame.</p>
<p>Suppose cohort2 with definition_id = 1 contains stroke occurrences.
If we want to exclude patients from cohort1 who had a stroke event in
the last 180 days before entering the cohort, we can use the
<code><a href="../reference/flagCohortPresence.html">flagCohortPresence()</a></code> like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1WashOut</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/flagCohortPresence.html">flagCohortPresence</a></span><span class="op">(</span></span>
<span>    cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohort_1_m180_to_m1</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1WashOut</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 5</span></span>
<span><span class="co">## Database: DuckDB 0.7.1 [unknown@Linux 5.15.0-1035-azure:R 4.3.0/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2, 1</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3, 2</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-01-01, 2020-01-02</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-03-01, 2020-02-02</span></span>
<span><span class="co">## $ cohort_1_m180_to_m1  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0, 0</span></span></code></pre>
<p><code><a href="../reference/countCohortOccurrences.html">countCohortOccurrences()</a></code>: adds a column where it
indicates the number of intersections in a certain time window.</p>
<p>We can use the function to count the number of occurrences of an
event of interest in different time windows before entering the study
population. For example, we can look at the number of strokes in the
0-90 day, 90-365 day, and all prior history windows:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1StrokeCounts</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/countCohortOccurrences.html">countCohortOccurrences</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="op">-</span><span class="fl">366</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">365</span>,<span class="op">-</span><span class="fl">181</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1StrokeCounts</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## Database: DuckDB 0.7.1 [unknown@Linux 5.15.0-1035-azure:R 4.3.0/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 2, 1</span></span>
<span><span class="co">## $ subject_id            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 3, 2</span></span>
<span><span class="co">## $ cohort_start_date     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-01-01, 2020-06-01, 2020-01-01, 2020-01-02</span></span>
<span><span class="co">## $ cohort_end_date       <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-04-01, 2020-08-01, 2020-03-01, 2020-02-02</span></span>
<span><span class="co">## $ cohort_1_minf_to_m366 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0, 0, 0, 0</span></span>
<span><span class="co">## $ cohort_1_m180_to_m1   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 2, 0, 0</span></span>
<span><span class="co">## $ cohort_1_m365_to_m181 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0, 0, 0, 0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="example-timetocohort-function">Example: timeToCohort function<a class="anchor" aria-label="anchor" href="#example-timetocohort-function"></a>
</h2>
<p><code><a href="../reference/timeToCohort.html">timeToCohort()</a></code>: adds a new column that indicates the
number of days in which the subject intersects with another cohort
during a specific time frame. If there are multiple intersections, only
one will be computed, either the first or the latest one in the time
window (“order” argument).</p>
<p>The function can be utilized to calculate the time to the event of
interest, such as time until the first stroke after index date. If the
patient did not experience the event, the function will return NA.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1TimeTo</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/timeToCohort.html">timeToCohort</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    order <span class="op">=</span> <span class="st">"first"</span>,</span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1TimeTo</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 5</span></span>
<span><span class="co">## Database: DuckDB 0.7.1 [unknown@Linux 5.15.0-1035-azure:R 4.3.0/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 2, 1</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 3, 2</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-01-01, 2020-06-01, 2020-01-01, 2020-01-02</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-04-01, 2020-08-01, 2020-03-01, 2020-02-02</span></span>
<span><span class="co">## $ cohort_1_0_to_inf    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 145, NA, 0, NA</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="example-dateofcohort-function">Example: dateOfCohort function<a class="anchor" aria-label="anchor" href="#example-dateofcohort-function"></a>
</h2>
<p><code><a href="../reference/dateOfCohort.html">dateOfCohort()</a></code>: appends a column containing the start
date of cohorts that are present in a certain window.</p>
<p>This function can be handy in obtaining the date of the next
occurrence of a specific event. For instance, suppose cohort1 comprises
patients who enrolled when they received their first vaccine dose. We
could use this function to obtain the date of their second dose if we
have a cohort with vaccine records (e.g. cohort2):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1NextEvent</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dateOfCohort.html">dateOfCohort</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    order <span class="op">=</span> <span class="st">"first"</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1NextEvent</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 5</span></span>
<span><span class="co">## Database: DuckDB 0.7.1 [unknown@Linux 5.15.0-1035-azure:R 4.3.0/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 2, 1</span></span>
<span><span class="co">## $ subject_id           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 3, 2</span></span>
<span><span class="co">## $ cohort_start_date    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-01-01, 2020-06-01, 2020-01-01, 2020-01-02</span></span>
<span><span class="co">## $ cohort_end_date      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-04-01, 2020-08-01, 2020-03-01, 2020-02-02</span></span>
<span><span class="co">## $ cohort_1_1_to_inf    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-05-25, NA, NA, NA</span></span></code></pre>
<p>Please note that the new columns added to the table (for all function
presented) will have the format cohort_“cohort_definition_id”_ “time
window”. If the window number is negative, a “m” will be added in front
to indicate it and no sign will be added to positive numbers.</p>
</div>
<div class="section level2">
<h2 id="example-addcohortintersect-function">Example: addCohortIntersect function<a class="anchor" aria-label="anchor" href="#example-addcohortintersect-function"></a>
</h2>
<p><code><a href="../reference/addCohortIntersect.html">addCohortIntersect()</a></code>: Compute the intersect with a
target cohort, you can compute the number of occurrences, a flag of
presence, a certain date and/or the time difference.</p>
<p>We can use the function to compute all the intersect information with
a target cohort. By default it will return output from
<code><a href="../reference/countCohortOccurrences.html">countCohortOccurrences()</a></code>, <code><a href="../reference/dateOfCohort.html">dateOfCohort()</a></code>,
<code><a href="../reference/flagCohortPresence.html">flagCohortPresence()</a></code> and <code><a href="../reference/timeToCohort.html">timeToCohort()</a></code> in a
time frame. Use this function if you want to append all the intersection
information with this function. For information on what these function
does, you can read above example.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1CohortIntersect</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addCohortIntersect.html">addCohortIntersect</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    order <span class="op">=</span> <span class="st">"first"</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1CohortIntersect</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 8</span></span>
<span><span class="co">## Database: DuckDB 0.7.1 [unknown@Linux 5.15.0-1035-azure:R 4.3.0/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 2, 1</span></span>
<span><span class="co">## $ subject_id              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 3, 2</span></span>
<span><span class="co">## $ cohort_start_date       <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-01-01, 2020-06-01, 2020-01-01, 2020-01-02</span></span>
<span><span class="co">## $ cohort_end_date         <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-04-01, 2020-08-01, 2020-03-01, 2020-02-02</span></span>
<span><span class="co">## $ count_cohort_1_1_to_inf <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 0, 0, 0</span></span>
<span><span class="co">## $ flag_cohort_1_1_to_inf  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 0, 0, 0</span></span>
<span><span class="co">## $ date_cohort_1_1_to_inf  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-05-25, NA, NA, NA</span></span>
<span><span class="co">## $ time_cohort_1_1_to_inf  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 145, NA, NA, NA</span></span></code></pre>
<p>We can also control which columns to append to your data by using the
flag, count, date and time options in the function, if we do not want
everything. For example if we only want the cohort count and flag we can
use below example.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1CohortIntersect</span> <span class="op">&lt;-</span> <span class="va">cdm</span><span class="op">$</span><span class="va">cohort1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/addCohortIntersect.html">addCohortIntersect</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>    targetCohortTable <span class="op">=</span> <span class="st">"cohort2"</span>,</span>
<span>    order <span class="op">=</span> <span class="st">"first"</span>,</span>
<span>    targetCohortId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="cn">Inf</span><span class="op">)</span>,</span>
<span>    flag <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    count <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    date <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    time <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">cdm</span><span class="op">$</span><span class="va">cohort1CohortIntersect</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: ??</span></span>
<span><span class="co">## Columns: 6</span></span>
<span><span class="co">## Database: DuckDB 0.7.1 [unknown@Linux 5.15.0-1035-azure:R 4.3.0/:memory:]</span></span>
<span><span class="co">## $ cohort_definition_id    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 2, 1</span></span>
<span><span class="co">## $ subject_id              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 3, 2</span></span>
<span><span class="co">## $ cohort_start_date       <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-01-01, 2020-06-01, 2020-01-01, 2020-01-02</span></span>
<span><span class="co">## $ cohort_end_date         <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2020-04-01, 2020-08-01, 2020-03-01, 2020-02-02</span></span>
<span><span class="co">## $ count_cohort_1_1_to_inf <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 0, 0, 0</span></span>
<span><span class="co">## $ flag_cohort_1_1_to_inf  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 0, 0, 0</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marti Catala, Yuchen Guo, Mike Du, Kim Lopez-Guell, Edward Burn.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
